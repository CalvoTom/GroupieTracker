<!DOCTYPE html>
<html>
    <head>
        <title>test</title>
        <meta charset="utf-8"/>
        <link rel="stylesheet" type="text/css"/>
    </head>
    <body>
        {{ .Letter }}
        <div class="table-conteneur">
            <table id="heroes-table" class="table-scrollable">
                <thead >
                    <tr>
                        {{ range $index, $category := .Cattegories }}
                            <th>{{ $category }}</th>
                        {{ end }}
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <form id="scattegories" method="post" action="/scattegoriesChecker">
                            {{ range $index, $category := .Cattegories }}
                                <td><input name="$category" placeholder="$category" required></input></td>
                            {{ end }}
                            <button type="submit" form="scattegories" id="submit-btn">
                                <input type="hidden" name="button-value" id="button-value" value="">
                                <p>Submit</p>
                            </button>
                            <p id="timer"></p>
                        </form>
                    </tr>
                </tbody>
            </table>
        </div>
        <script>
            let ws = new WebSocket("ws://" + window.location.hostname + ":8080/ws")
    
            ws.onopen = function(){
                console.log("Websocket open")
            }
    
            ws.onmessage = function(event){
                if (event.data.startsWith("end_")){
                    let code = getCookie("code")
                    if (event.data.includes(code)){
                        let userid = getCookie("userId")
                        if (!event.data.includes(userid)){
                            document.getElementById("scattegories").submit()
                        }
                    }
                }
            }

        </script>
        <script>
            let btn = document.getElementById("submit-btn")
            btn.addEventListener("click", function(){
                let userId = getCookie("userId")
                document.getElementById("button-value").value = userId   
            })
            let timerElement = document.getElementById("timer");
            let timeLeft = 60;
            let timerInterval = setInterval(function() {
                timerElement.textContent = `Time left: ${timeLeft} seconds`;
                timeLeft--;
                if (timeLeft < 0) {
                    clearInterval(timerInterval);
                    document.getElementById("scattegories").submit();
                }
            }, 1000);

            function getCookie(name) {
                const cookieName = name;
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.startsWith(cookieName + '=')) {
                    return cookie.substring(cookieName.length + 1);
                    }
                }
                return null;
            }
        </script>
    </body>
</html> 